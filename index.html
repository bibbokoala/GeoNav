<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <link href="css/bootstrap.min.css" rel="stylesheet">
   <link href="css/custom.css" rel="stylesheet">
<script src="phonegap.js"></script>
   <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
   <script src="js/jquery.min.js"></script>
   <script src="js/menu.js"></script>
<script>
$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '"');
        } else {
            o[this.name] = this.value || '"';
        }
    });
    return o;
};
  function onSuccess(data, status)
  {
    console.log("data.status: "+data.status);
    console.log("data: "+ JSON.stringify(data));
    localStorage.setItem("auth", data.auth);
    localStorage.setItem("token", data.token);
    localStorage.setItem("login", data.auth);
    if (data.auth.localeCompare("OK")==0)
    {
       localStorage.setItem("link", "menu");
       window.location = "menu.html";
    }
    else
    {
       window.location = "index.html";
    }
  }
  function onError(data, status)
  {
    //var htmlString = "<p>ERRORE Login!</p>";
    //document.getElementById("result").innerHTML = htmlString;
    console.log("data.status: "+data.status);
    console.log("data: "+ JSON.stringify(data));
    localStorage.setItem("link", "menu");
    localStorage.setItem("login", "NOK!");
  }   
  $(document).ready(function() {
    $("#btn_login").click(function(){
      console.log(callAjaxForm);
      var formData = $("#callAjaxForm").serialize();
      //var formData = JSON.stringify($('#callAjaxForm').serializeObject())
      console.log(formData);
      //http://medley.cloudmup.com/GeoLocREST/GNLogin?JSON={"matricola":"37210890","password":"xxx"}
      //var url = "http://medley.cloudmup.com/GeoLocREST/GNLogin?JSON="+formData
      //var url = "http://medley.cloudmup.com/GeoLocREST/GNLogin";
      var url = "http://service.cloudmup.com/GOALocale/GeoNavLogin.php";
      console.log(url);
      $.ajax({
        type: "GET",
        url: url,
        cache: false,
        dataType: "jsonp",
        data: formData,
        success: onSuccess,
        error: onError
      });
      //return false;
    });

  });  
</script>
</head>
<body>
    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top" style="background-color:#DE0019;">
      <div class="container">
        <div class="navbar-header">
          <!-- solo per la pagina index.html NON ESISTE IL MENU ed il logo ha un margine di 40 pixel -->
          <div class="navbar-header" style="line-height: 56px;" id="testata" >
            <img src="pics/geonav.png" height="56px" align="left" id="logo_small" style="margin-left:40px;" />
          </div>
        </div>
      </div>
    </nav>
    <!-- <div class="container-fluid" style="max-width: 540px;" id="fluido" > -->
    <div class="container-fluid" id="fluido" >
      <div class="row">
        <div class="col-sm-12 col-sm-offset-0 col-md-12 col-md-offset-0 main" id="contenuto" >
          <center>
            <a href='index.html' ><img src="pics/logo.png" height="112px" border=0 id="logo_big" /></a><br><br>
          </center>
          <form id="callAjaxForm">
           <label for='matricola'>Inserire Matricola</label>
           <input type=text id='matricola' name='matricola' placeholder='Matricola' class='form-control-custom' required='true' >
           <br>
           <label for='password'>Inserire Password LDAP</label>
           <input type=password id='password' name='password' placeholder='Password' class='form-control-custom' required='true' >
           <br>
           <div id="result"></div>
           <br>
           <label for='chiaro'>Password in chiaro</label>
           <input id='chiaro' class="pull-right" type="checkbox" value="checkbox" onchange="password_in_chiaro(this)" style="margin-left:1px;margin-top:5px;" />
           <br>
           <label for='cred'>Salva credenziali</label>
           <input id='cred' class="pull-right" type="checkbox" value="checkbox" style="margin-left:1px;margin-top:5px;" />
           <br>
           <br>
           <br>
        </div> <!-- close <div class="col-sm-12 col-sm-offset-0 col-md-12 col-md-offset-0 main"> -->
        <div id="my_footer" class="col-sm-12 col-sm-offset-0 col-md-12 col-md-offset-0 " >   
           <button id="btn_login" type="button" class='btn btn-default btn-lg bottone' >
             <span class="glyphicon glyphicon-log-in pull-left" aria-hidden="true"></span>Accedi
           </button>
           </form>
           <br>
        </div> <!-- close <div class="col-sm-12 col-sm-offset-0 col-md-12 col-md-offset-0 main"> -->
      </div> <!-- close div row --> 
    </div> <!-- close div container-fluid -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script>
    function password_in_chiaro(checkbox)
    {
        if (checkbox.checked)
        {
            var password = document.getElementById("password");
            password.type="text";
        }
        else
        {
            var password = document.getElementById("password");
            password.type="password";
        }
    }
    </script>
<!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSOthkwq0sKfWCDOCUmnfSlzeUi72r7hg&signed_in=true&callback=initMap"></script> -->
</body>
</html>